/*!
 * Figuration Table(v0.0.1)
 * https://github.com/cast-org/figuration-table
 * Copyright 2017 CAST, Inc.
 * Licensed under MIT (https://github.com/cast-org/figuration-table/blob/master/LICENSE)
 */
if("undefined"==typeof jQuery)throw new Error("Figuration Table's JavaScript requires jQuery");!function(a){var b=a.fn.jquery.split(" ")[0].split(".");if(b[0]<2&&b[1]<9||1==b[0]&&9==b[1]&&b[2]<1||b[0]>=4)throw new Error("Figuration Table's JavaScript requires at least jQuery v1.9.1 but less than v4.0.0")}(jQuery),function(a){"use strict";function b(a){a&&a()}function c(){var a=document.createElement("div"),b={transition:"transitionend",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",WebkitTransition:"webkitTransitionEnd"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]};return{end:h}}function d(a){var b=[0];a.each(function(){var c=a.css("transition-duration")||a.css("-webkit-transition-duration")||a.css("-moz-transition-duration")||a.css("-ms-transition-duration")||a.css("-o-transition-duration");if(c)for(var d=c.split(","),e=d.length;e--;)b=b.concat(parseFloat(d[e]))});var c=Math.max.apply(Math,b);return c*=1e3}function e(a,c){var e=d(this);if(e){var f=!1;this.one(h,function(){f||(f=!0,b(c))}),setTimeout(function(){f||(f=!0,b(c))},e),b(a)}else b(a),b(c);return this}function f(){return{bindType:g.end,delegateType:g.end,handle:function(b){if(a(b.target).is(this))return b.handleObj.handler.apply(this,arguments)}}}String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};var g=!1,h="cfwTransitionEnd";a(function(){g=c(),a.fn.CFW_transition=e,a.event.special[h]=f()}),a.fn.CFW_getID=function(b){var c=a(this),d=c.attr("id");if(void 0===d){do d=b+"-"+~~(1e6*Math.random());while(document.getElementById(d));c.attr("id",d)}return d},a.fn.CFW_trigger=function(b,c){var d=a.Event(b);return a.isPlainObject(c)&&(d=a.extend({},d,c)),a(this).trigger(d),!d.isDefaultPrevented()},a.fn.CFW_parseData=function(b,c){var d={},e=a(this),f=e.data();b=b.capitalize();for(var g in c)if(c.hasOwnProperty(g)){var h=g.capitalize();"undefined"!=typeof f["cfw"+b+h]&&(d[g]=f["cfw"+b+h])}return d},a.fn.CFW_throttle=function(a,b,c){void 0===b&&(b=250);var d,e;return function(){var f=c||this,g=+new Date,h=arguments;d&&g<d+b?(clearTimeout(e),e=setTimeout(function(){d=g,a.apply(f,h)},b)):(d=g,a.apply(f,h))}}}(jQuery),function(a){"use strict";function b(b){var d=[].splice.call(arguments,1);return this.each(function(){var e=a(this),f=e.data("cfw.table"),g="object"==typeof b&&b;return!(!f&&/dispose/.test(b))&&(f||e.data("cfw.table",f=new c(this,g)),void("string"==typeof b&&f[b].apply(f,d)))})}var c=function(b,d){this.element=b,this.$element=a(b),this.$active=null,this.$editor=null,this.$sorter=null,this.instance=null,this.selectors=c.SELECTORS;var e=this.$element.CFW_parseData("table",c.DEFAULTS);this.settings=a.extend({},c.DEFAULTS,e,d),this._init()};c.DEFAULTS={sortable:!1,editable:!1,coledit:!1,editor:'<input type="text">',editorProps:["font","font-size","font-family","font-weight","line-height","text-align","padding","padding-top","padding-bottom","padding-left","padding-right","border","border-top","border-bottom","border-left","border-right","box-shadow","outline"]},c.SELECTORS={headRow:"thead tr",headCols:"thead th",headCells:"th",bodyElm:"tbody",bodyRows:"tbody tr",bodyCells:"tbody td",rowElm:"tr",rowCells:"td"},c.prototype={_init:function(){this.instance=this.$element.CFW_getID("cfw-table"),this.$element.addClass("figuration-table"),this.settings.editable&&this.editEnable(),this.settings.coledit&&this.colEditEnable(),this.settings.sortable&&this.sortEnable(),this.$element.CFW_trigger("init.cfw.table")},insertRow:function(b){var c=this;null==b&&(b=-1);for(var d=this.$element.find(this.selectors.bodyRows),e=Math.max.apply(null,d.map(function(){return a(this).find(c.selectors.rowCells).length}).get()),f=this.$element.find(this.selectors.bodyElm)[0].insertRow(b),g=0;g<e;g++){var h=f.insertCell(g);this._updateCell(h)}},deleteRow:function(a){null==a&&(a=-1);var b=this.$element.find(this.selectors.bodyRows);b.length>1&&this.element.deleteRow(a)},appendCol:function(a){null==a&&(a=-1);var b=this.$element.find(this.selectors.headRow)[0],c=document.createElement("th");if(a==-1)b.appendChild(c);else{var d=this.$element.find(this.selectors.headCols).get(a);b.insertBefore(c,d)}for(var e=this.$element.find(this.selectors.bodyRows),f=e.length,g=0;g<f;g++)this._updateCell(e[g].insertCell(a));this.settings.sortable&&this._sortUpdate()},removeCol:function(a){null==a&&(a=-1);var b=this.$element.find(this.selectors.headCols);if(b.length>1){var c=this.$element.find(this.selectors.headRow)[0];c.deleteCell(a);for(var d=this.$element.find(this.selectors.bodyRows),e=d.length,f=0;f<e;f++)d[f].deleteCell(a)}this.settings.sortable&&this._sortUpdate()},_updateCells:function(){var b=this,c=this.$element.find(this.selectors.rowCells);a.each(c,function(){var c=a(this);b._updateCell(c)})},_resetCell:function(a){a.removeAttr("tabindex").removeClass("text-right")},_updateCell:function(b){var c=a(b);this._resetCell(c),a.isNumeric(c.text())&&c.addClass("text-right"),this.settings.editable&&c.attr("tabindex",0)},_showEditor:function(){(this.settings.editable||this.settings.coledit)&&(this.$active=this.$element.find("td:focus, th:focus"),this.$active.length&&this._editorCreate(this.$active))},_actionKeydown:function(a){if(/(13|37|38|39|40)/.test(a.which)){if(a.stopPropagation(),a.preventDefault(),13==a.which)return void this._showEditor();var b=this._actionMove(a);b&&b.length>0&&b.focus()}},_actionMove:function(b){var c=a(b.target),d=c.parent(),e=d.prev(),f=d.next(),g=this.selectors.rowCells;if(this.settings.sortable||this.settings.coledit){g=g+","+this.selectors.headCells;for(var h=this.$element.find(this.selectors.rowElm),i=h.length,j=0;j<i;j++)if(h.eq(j).is(d)){e=j>0?h.eq(j-1):null,f=j<i?h.eq(j+1):null;break}}switch(b.which){case 37:return c.prev(g);case 38:return e.children().eq(c.index());case 39:return c.next(g);case 40:return f.children().eq(c.index())}},_editorCreate:function(b){var c=this;this.$editor=a(this.settings.editor).val(b.text()).addClass("figuration-table-editor").css(b.css(this.settings.editorProps)).appendTo("body"),this._editorPosition(),this.$editor.trigger("focus"),a(window).on("resize.cfw.table"+this.instance,a.proxy(this._editorPosition,this)),this.$editor.on("blur.cfw.table",function(){c._setActiveValue(),c._editorRemove()}).on("keydown.cfw.table",function(a){if(/(37|38|39|40)/.test(a.which))return void a.stopPropagation();if(/(9|13|27)/.test(a.which)){if(9==a.which)return void c.$active.trigger("focus");13==a.which&&(a.stopPropagation(),a.preventDefault(),c.$active.trigger("focus")),27==a.which&&(a.stopPropagation(),a.preventDefault(),c.$editor.val(c.$active.text()),c.$active.trigger("focus"))}}).on("input.cfw.table paste.cfw.table",function(){var a=c.$active.CFW_trigger("validate.cfw.table",{value:c.$editor.val()});a===!1?c.$editor.addClass("error"):c.$editor.removeClass("error")})},_editorPosition:function(){this.$editor.is(":visible")&&this.$editor.offset(this.$active.offset()).width(this.$active.width()).height(this.$active.height())},_editorRemove:function(){a(window).off("resize.cfw.table"+this.instance),this.$editor&&this.$editor.remove(),this.$editor=null,this.$active=null},_setActiveValue:function(){var a=this.$editor.val(),b=this.$active.html();if(this.$active.text()===a||this.$editor.hasClass("error"))return!0;var c=this.$active.text(a).CFW_trigger("change.cfw.table",{value:a});c===!1&&this.$active.html(b)},editEnable:function(){this.settings.editable=!0,this.$element.on("click.cfw.table",this.selectors.rowCells,a.proxy(this._showEditor,this)).on("keydown.cfw.table",this.selectors.rowCells,a.proxy(this._actionKeydown,this)).addClass("editable"),this._updateCells()},editDisable:function(){this.settings.editable=!1,this.$element.off("click.cfw.table",this.selectors.rowCells).off("keydown.cfw.table",this.selectors.rowCells).removeClass("editable"),this._updateCells()},_sortSimple:function(b,c){function d(b,c){return a(b).children("td").eq(c).html()}function e(b){return function(c,e){var f=d(c,b),g=d(e,b);return a.isNumeric(f)&&a.isNumeric(g)?f-g:f.localeCompare(g)}}if(this.settings.sortable){void 0===c&&(c=!0),this.$sorter=this.$element.find(this.selectors.headCols).eq(b);var f=this.$element.find(this.selectors.bodyRows),g=this.$sorter.data("cfw.table.sortOrder");void 0!==typeof g&&(c=!g),this.$sorter.data("cfw.table.sortOrder",c);var h=f.toArray().sort(e(b)),i=h.length;c||(h=h.reverse());for(var j=0;j<i;j++)this.$element.find(this.selectors.bodyElm).append(h[j]);this._sortUpdate()}},_sortUpdate:function(){var a=this.$element.find(this.selectors.headCols),b=this.$sorter&&this.$sorter.data("cfw.table.sortOrder"),c=b?"ascending":"descending";if(a.removeAttr("aria-sort").removeClass("sort-icon sort-ascending sort-descending").removeData("cfw.table.sortOrder"),this.settings.sortable?a.attr("tabindex",0).addClass("sort-icon"):a.removeAttr("tabindex"),null!==this.$sorter){var d="sort-"+c;this.$sorter.addClass(d).attr("aria-sort",c).data("cfw.table.sortOrder",b)}},sortEnable:function(){var b=this;this.settings.coledit&&this.colEditDisable(),this.settings.sortable=!0,this.$element.on("click.cfw.table",this.selectors.headCols,function(c){var d=a(c.target).index();b._sortSimple(d)}).on("keydown.cfw.table",this.selectors.headCols,function(c){if(/(13|37|38|39|40)/.test(c.which)){if(c.stopPropagation(),c.preventDefault(),13==c.which){var d=a(c.target).index();return void b._sortSimple(d)}var e=b._actionMove(c);e&&e.length>0&&e.focus()}}).addClass("sortable"),this._sortUpdate()},sortDisable:function(){this.settings.sortable=!1,this.$element.off("click.cfw.table",this.selectors.headCols).off("keydown.cfw.table",this.selectors.headCols).removeClass("sortable"),this.$sorter=null,this._sortUpdate()},colEditEnable:function(){this.settings.sortable&&this.sortDisable(),this.settings.coledit=!0;var b=this.$element.find(this.selectors.headCols);b.attr("tabindex",0),this.$element.on("click.cfw.table",this.selectors.headCols,a.proxy(this._showEditor,this)).on("keydown.cfw.table",this.selectors.headCols,a.proxy(this._actionKeydown,this))},colEditDisable:function(){this.settings.coledit=!1,this.$element.off("click.cfw.table",this.selectors.headCols).off("keydown.cfw.table",this.selectors.headCols);var a=this.$element.find(this.selectors.headCols);a.removeAttr("tabindex")},dispose:function(){this._editorRemove(),this.editDisable(),this.sortDisable(),this.$element.removeClass("figuration-table").off(".cfw.table").removeData("cfw.table"),this.element=null,this.$element=null,this.$active=null,this.$editor=null,this.$sorter=null,this.instance=null,this.selectors=null,this.settings=null}},a.fn.CFW_Table=b,a.fn.CFW_Table.Constructor=c,a(window).ready(function(){"undefined"!=typeof CFW_API&&CFW_API===!1||a('[data-cfw="table"]').CFW_Table()})}(jQuery);